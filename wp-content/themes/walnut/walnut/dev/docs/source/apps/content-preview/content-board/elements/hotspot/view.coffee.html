<!DOCTYPE html>
<html>
<head>
  <title>view.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../../../doc-style.css" />
  <script src="../../../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../../../", thisFile = "source\\apps\\content-preview\\content-board\\elements\\hotspot\\view.coffee", defaultSidebar = true;
  </script>
  <script src="../../../../../../doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs">
          <h1>view.coffee</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1">&#182;</a>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">define</span> <span class="p">[</span><span class="s">&#39;app&#39;</span><span class="p">],</span> <span class="nf">(App)-&gt;</span>
  <span class="nx">App</span><span class="p">.</span><span class="nx">module</span> <span class="s">&quot;ContentPreview.ContentBoard.Element.Hotspot.Views&quot;</span><span class="p">,</span>
  <span class="nf">(Views, App, Backbone, Marionette, $, _)-&gt;</span>
    
    <span class="k">class</span> <span class="nx">Views</span><span class="p">.</span><span class="nx">HotspotView</span> <span class="k">extends</span> <span class="nx">Marionette</span><span class="p">.</span><span class="nx">ItemView</span>

      <span class="nv">className: </span><span class="s">&#39;stage&#39;</span>


      <span class="nv">initialize: </span><span class="nf">(opt = {})-&gt;</span>
        <span class="vi">@answerModel = </span><span class="nx">opt</span><span class="p">.</span><span class="nx">answerModel</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2">&#182;</a>
</div>
<p>create layer collections</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="vi">@textCollection = </span><span class="nx">@model</span><span class="p">.</span><span class="nx">get</span> <span class="s">&#39;textCollection&#39;</span>
        <span class="vi">@optionCollection = </span><span class="nx">@model</span><span class="p">.</span><span class="nx">get</span> <span class="s">&#39;optionCollection&#39;</span>
        <span class="vi">@imageCollection = </span><span class="nx">@model</span><span class="p">.</span><span class="nx">get</span> <span class="s">&#39;imageCollection&#39;</span>





</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3">&#182;</a>
</div>
<p>give a unique name to every hotspot canvas</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="vi">@stageName = </span><span class="nx">_</span><span class="p">.</span><span class="nx">uniqueId</span><span class="p">(</span><span class="s">&#39;stage&#39;</span><span class="p">)</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4">&#182;</a>
</div>
<p>create the canvas layers</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="vi">@imageLayer = </span><span class="k">new</span> <span class="nx">Kinetic</span><span class="p">.</span><span class="nx">Layer</span>
          <span class="nv">name: </span><span class="s">&#39;imageLayer&#39;</span>
        <span class="vi">@optionLayer = </span><span class="k">new</span> <span class="nx">Kinetic</span><span class="p">.</span><span class="nx">Layer</span>
          <span class="nv">name: </span><span class="s">&#39;optionLayer&#39;</span>
        <span class="vi">@textLayer = </span><span class="k">new</span> <span class="nx">Kinetic</span><span class="p">.</span><span class="nx">Layer</span>
          <span class="nv">name: </span><span class="s">&#39;textLayer&#39;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5">&#182;</a>
</div>
<p>layer to show the user which option is selected</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="vi">@answerLayer = </span><span class="k">new</span> <span class="nx">Kinetic</span><span class="p">.</span><span class="nx">Layer</span>
          <span class="nv">name: </span><span class="s">&#39;answerLayer&#39;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6">&#182;</a>
</div>
<p>layer to show feedback to user on clicking submit</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="vi">@feedbackLayer = </span><span class="k">new</span> <span class="nx">Kinetic</span><span class="p">.</span><span class="nx">Layer</span>
          <span class="nv">name: </span><span class="s">&#39;feedbackLayer&#39;</span>


      <span class="nv">onRender: </span><span class="nf">-&gt;</span>
        <span class="nx">@$el</span><span class="p">.</span><span class="nx">attr</span> <span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="nx">@stageName</span>


      <span class="nv">onShow: </span><span class="p">()</span><span class="nf">-&gt;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7">&#182;</a>
</div>
<p>create a kinetic stage</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="vi">@stage = </span><span class="k">new</span> <span class="nx">Kinetic</span><span class="p">.</span><span class="nx">Stage</span>
          <span class="nv">container: </span><span class="nx">@stageName</span>
          <span class="nv">width: </span><span class="nx">@$el</span><span class="p">.</span><span class="nx">parent</span><span class="p">().</span><span class="nx">width</span><span class="p">()</span>
          <span class="nv">height: </span><span class="nx">@$el</span><span class="p">.</span><span class="nx">parent</span><span class="p">().</span><span class="nx">height</span><span class="p">()</span> <span class="o">+</span> <span class="mi">80</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8">&#182;</a>
</div>
<p>if height in model isnt 0 then set the stage height</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">if</span> <span class="nx">@model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;height&#39;</span><span class="p">)</span> <span class="o">isnt</span> <span class="mi">0</span>
          <span class="nx">@stage</span><span class="p">.</span><span class="nx">height</span> <span class="nx">@model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;height&#39;</span><span class="p">)</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9">&#182;</a>
</div>
<p>add the canvas layers</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">@stage</span><span class="p">.</span><span class="nx">add</span> <span class="nx">@imageLayer</span>
        <span class="nx">@stage</span><span class="p">.</span><span class="nx">add</span> <span class="nx">@textLayer</span>
        <span class="nx">@stage</span><span class="p">.</span><span class="nx">add</span> <span class="nx">@optionLayer</span>
        <span class="nx">@stage</span><span class="p">.</span><span class="nx">add</span> <span class="nx">@answerLayer</span>
        <span class="nx">@stage</span><span class="p">.</span><span class="nx">add</span> <span class="nx">@feedbackLayer</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10">&#182;</a>
</div>
<p>add the border to canvas</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">@_addBorderBox</span><span class="p">()</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11">&#182;</a>
</div>
<p>draw the elements</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">@_drawExistingElements</span><span class="p">()</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12">&#182;</a>
</div>
<p>set the handler for click events</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">@_clickHandler</span><span class="p">()</span>

        <span class="nx">@$el</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="s">&#39;.preview&#39;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s">&#39;#submit-answer-button&#39;</span><span class="p">).</span><span class="nx">on</span> <span class="s">&#39;click&#39;</span><span class="p">,</span> <span class="o">=&gt;</span>
          <span class="nx">@trigger</span> <span class="s">&quot;submit:answer&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13">&#182;</a>
</div>
<p>the handler for all click events
iterate thru each option defined
if the options are set to transparent mode then add click handlers to
the region outside the options</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">_clickHandler: </span><span class="nf">-&gt;</span>
        <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">@optionLayer</span><span class="p">.</span><span class="nx">getChildren</span><span class="p">(),</span> <span class="nx">@_iterateThruOptions</span>
        <span class="k">if</span> <span class="nx">@model</span><span class="p">.</span><span class="nx">get</span> <span class="s">&#39;transparent&#39;</span>
          <span class="nx">@stage</span><span class="p">.</span><span class="nx">on</span> <span class="s">&#39;click&#39;</span><span class="p">,</span> <span class="nx">@_onOutsideClick</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14">&#182;</a>
</div>
<p>handler for click event outside of the options area
create an object with the pointer position and the id</p>

<p>push data into the answr model
set the blinker at the position where click occured</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">_onOutsideClick: </span><span class="o">=&gt;</span>
        <span class="nv">answerObject = </span><span class="nx">@stage</span><span class="p">.</span><span class="nx">getPointerPosition</span><span class="p">()</span>
        <span class="nv">answerObject.id = </span><span class="nx">_</span><span class="p">.</span><span class="nx">uniqueId</span><span class="p">(</span><span class="s">&#39;out&#39;</span><span class="p">)</span>
        <span class="nx">@answerModel</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;answer&#39;</span><span class="p">).</span><span class="nx">push</span> <span class="nx">answerObject</span>
        <span class="nx">@_setBlinker</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">answerObject</span><span class="p">)</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15">&#182;</a>
</div>
<p>iterator for the option
set click handler for the options</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">_iterateThruOptions: </span><span class="nf">(option)=&gt;</span>
        <span class="nx">option</span><span class="p">.</span><span class="nx">on</span> <span class="s">&#39;click&#39;</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span> <span class="nx">@_onOptionClick</span><span class="p">,</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">option</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16">&#182;</a>
</div>
<p>function to run on click of option
stop event propogation
create answer object with click position and id</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">_onOptionClick: </span><span class="nf">(option, evt)-&gt;</span>
        <span class="nv">evt.cancelBubble = </span><span class="kc">true</span>
        <span class="nv">answerObject = </span><span class="nx">@stage</span><span class="p">.</span><span class="nx">getPointerPosition</span><span class="p">()</span>
        <span class="nv">answerObject.id = </span><span class="nx">option</span><span class="p">.</span><span class="nx">id</span><span class="p">()</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17">&#182;</a>
</div>
<p>if id not already present push into the array</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">if</span> <span class="o">not</span> <span class="nx">_</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">pluck</span><span class="p">(</span><span class="nx">@answerModel</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;answer&#39;</span><span class="p">),</span> <span class="s">&#39;id&#39;</span><span class="p">),</span> <span class="nx">option</span><span class="p">.</span><span class="nx">id</span><span class="p">())</span>
          <span class="nx">@answerModel</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;answer&#39;</span><span class="p">).</span><span class="nx">push</span> <span class="nx">answerObject</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18">&#182;</a>
</div>
<p>if not transparent blink the option otherwise show small blinker at the click location</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="k">if</span> <span class="o">not</span> <span class="nx">@model</span><span class="p">.</span><span class="nx">get</span> <span class="s">&#39;transparent&#39;</span>
            <span class="nx">@_setBlinker</span><span class="p">(</span><span class="nx">option</span><span class="p">)</span>
          <span class="k">else</span>
            <span class="nx">@_setBlinker</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">answerObject</span><span class="p">)</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19">&#182;</a>
</div>
<p>create a blinker</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">_setBlinker: </span><span class="nf">(option, answerObject)-&gt;</span>
        <span class="nv">blinker = </span><span class="kc">null</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20">&#182;</a>
</div>
<p>if the clicked area is a visible option</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">if</span> <span class="nx">option</span>
          <span class="k">if</span> <span class="nx">option</span><span class="p">.</span><span class="nx">className</span> <span class="o">is</span> <span class="s">&#39;Circle&#39;</span>
            <span class="nv">blinker = </span><span class="k">new</span> <span class="nx">Kinetic</span><span class="p">.</span><span class="nx">Circle</span>
              <span class="nv">name: </span><span class="nx">option</span><span class="p">.</span><span class="nx">id</span><span class="p">()</span>
              <span class="nv">x: </span><span class="nx">option</span><span class="p">.</span><span class="nx">x</span><span class="p">()</span>
              <span class="nv">y: </span><span class="nx">option</span><span class="p">.</span><span class="nx">y</span><span class="p">()</span>
              <span class="nv">opacity: </span><span class="mf">0.5</span>
              <span class="nv">radius: </span><span class="nx">option</span><span class="p">.</span><span class="nx">radius</span><span class="p">()</span>
              <span class="nv">fill: </span><span class="s">&#39;blue&#39;</span>
          <span class="k">else</span> <span class="k">if</span> <span class="nx">option</span><span class="p">.</span><span class="nx">className</span> <span class="o">is</span> <span class="s">&#39;Rect&#39;</span>
            <span class="nv">blinker = </span><span class="k">new</span> <span class="nx">Kinetic</span><span class="p">.</span><span class="nx">Rect</span>
              <span class="nv">name: </span><span class="nx">option</span><span class="p">.</span><span class="nx">id</span><span class="p">()</span>
              <span class="nv">x: </span><span class="nx">option</span><span class="p">.</span><span class="nx">x</span><span class="p">()</span> <span class="o">+</span> <span class="nx">option</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span>
              <span class="nv">y: </span><span class="nx">option</span><span class="p">.</span><span class="nx">y</span><span class="p">()</span> <span class="o">+</span> <span class="nx">option</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span>
              <span class="nv">height: </span><span class="nx">option</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span>
              <span class="nv">width: </span><span class="nx">option</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span>
              <span class="nv">offset:</span>
                <span class="nv">x: </span><span class="nx">option</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="nv">y: </span><span class="nx">option</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span>
              <span class="nv">opacity: </span><span class="mf">0.5</span>
              <span class="nv">fill: </span><span class="s">&#39;blue&#39;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21">&#182;</a>
</div>
<p>if not a visible option</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">else</span>
          <span class="nv">blinker = </span><span class="k">new</span> <span class="nx">Kinetic</span><span class="p">.</span><span class="nx">Circle</span>
            <span class="nv">name: </span><span class="nx">answerObject</span><span class="p">.</span><span class="nx">id</span>
            <span class="nv">x: </span><span class="nx">answerObject</span><span class="p">.</span><span class="nx">x</span>
            <span class="nv">y: </span><span class="nx">answerObject</span><span class="p">.</span><span class="nx">y</span>
            <span class="nv">radius: </span><span class="mi">20</span>
            <span class="nv">opacity: </span><span class="mf">0.5</span>
            <span class="nv">fill: </span><span class="s">&#39;blue&#39;</span>

        <span class="nx">@answerLayer</span><span class="p">.</span><span class="nx">add</span> <span class="nx">blinker</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22">&#182;</a>
</div>
<p>animate the blinker                #</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nv">period = </span><span class="mi">3000</span><span class="p">;</span>
        <span class="nv">anim = </span><span class="k">new</span> <span class="nx">Kinetic</span><span class="p">.</span><span class="nx">Animation</span> <span class="nf">(frame)-&gt;</span>
          <span class="nv">scale = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">frame</span><span class="p">.</span><span class="nx">time</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="nx">period</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.001</span>
          <span class="nx">blinker</span><span class="p">.</span><span class="nx">scale</span>
            <span class="nv">x: </span><span class="nx">scale</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">-</span> <span class="mf">0.75</span>
            <span class="nv">y: </span><span class="nx">scale</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">-</span> <span class="mf">0.75</span>

        <span class="p">,</span> <span class="nx">@answerLayer</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23">&#182;</a>
</div>
<p>start animation</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">anim</span><span class="p">.</span><span class="nx">start</span><span class="p">()</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24">&#182;</a>
</div>
<p>stop animation</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">@listenTo</span> <span class="nx">@</span><span class="p">,</span> <span class="s">&quot;show:feedback&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
          <span class="nx">anim</span><span class="p">.</span><span class="nx">stop</span><span class="p">()</span>


        <span class="nx">blinker</span><span class="p">.</span><span class="nx">on</span> <span class="s">&#39;click&#39;</span><span class="p">,</span> <span class="o">=&gt;</span>
          <span class="nv">answerObject = </span><span class="nx">_</span><span class="p">.</span><span class="nx">findWhere</span> <span class="nx">@answerModel</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;answer&#39;</span><span class="p">),</span> <span class="p">{</span><span class="nv">id: </span><span class="nx">blinker</span><span class="p">.</span><span class="nx">name</span><span class="p">()}</span>
          <span class="nx">@answerModel</span><span class="p">.</span><span class="nx">set</span> <span class="s">&#39;answer&#39;</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">without</span> <span class="nx">@answerModel</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;answer&#39;</span><span class="p">),</span> <span class="nx">answerObject</span>
          <span class="nx">blinker</span><span class="p">.</span><span class="nx">off</span> <span class="s">&#39;click&#39;</span>
          <span class="nx">blinker</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25">&#182;</a>
</div>
<p>handler for "show:feedback" event</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">onShowFeedback: </span><span class="nf">-&gt;</span>
        <span class="nx">@answerLayer</span><span class="p">.</span><span class="nx">remove</span><span class="p">()</span>
        <span class="nv">correctOptions = </span><span class="nx">@optionCollection</span><span class="p">.</span><span class="nx">where</span> <span class="p">{</span><span class="nv">correct: </span><span class="kc">true</span><span class="p">}</span>
        <span class="nv">correctOptionsIds = </span><span class="nx">_</span><span class="p">.</span><span class="nx">pluck</span> <span class="nx">correctOptions</span><span class="p">,</span> <span class="s">&#39;id&#39;</span>
        <span class="nv">answerId = </span><span class="nx">_</span><span class="p">.</span><span class="nx">pluck</span> <span class="nx">@answerModel</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;answer&#39;</span><span class="p">),</span> <span class="s">&#39;id&#39;</span>
        <span class="nv">answeredWrongly = </span><span class="nx">_</span><span class="p">.</span><span class="nx">difference</span> <span class="nx">answerId</span><span class="p">,</span> <span class="nx">correctOptionsIds</span>
        <span class="nv">answeredCorrectly = </span><span class="nx">_</span><span class="p">.</span><span class="nx">intersection</span> <span class="nx">answerId</span><span class="p">,</span> <span class="nx">correctOptionsIds</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26">&#182;</a>
</div>
<p>load the feedback images</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">@_loadFeedbackImages</span>
          <span class="nv">answers: </span><span class="nx">correctOptionsIds</span>
          <span class="nv">correct: </span><span class="nx">answeredCorrectly</span>
          <span class="nv">wrong: </span><span class="nx">answeredWrongly</span>

      <span class="nv">_loadFeedbackImages: </span><span class="nf">(options)-&gt;</span>
        <span class="nx">@_showCorrectAnswers</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">answers</span><span class="p">)</span>
        <span class="nv">correctImage = </span><span class="k">new</span> <span class="nx">Image</span><span class="p">()</span>
        <span class="nv">correctImage.onload = </span><span class="o">=&gt;</span>
          <span class="nx">@_showMyAnswers</span> <span class="nx">options</span><span class="p">.</span><span class="nx">correct</span><span class="p">,</span> <span class="nx">correctImage</span>
        <span class="nv">correctImage.src = </span><span class="nx">THEMEURL</span> <span class="o">+</span> <span class="s">&#39;/images/right-ans.gif&#39;</span>
        <span class="nv">wrongImage = </span><span class="k">new</span> <span class="nx">Image</span><span class="p">()</span>
        <span class="nv">wrongImage.onload = </span><span class="o">=&gt;</span>
          <span class="nx">@_showMyAnswers</span> <span class="nx">options</span><span class="p">.</span><span class="nx">wrong</span><span class="p">,</span> <span class="nx">wrongImage</span>
        <span class="nv">wrongImage.src = </span><span class="nx">THEMEURL</span> <span class="o">+</span> <span class="s">&#39;/images/wrong-ans.gif&#39;</span>

      <span class="nv">_showMyAnswers: </span><span class="nf">(answersId, image)-&gt;</span>
        <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">answersId</span><span class="p">,</span> <span class="nf">(answerId)=&gt;</span>
          <span class="nv">answerShape = </span><span class="nx">_</span><span class="p">.</span><span class="nx">find</span> <span class="nx">@answerLayer</span><span class="p">.</span><span class="nx">getChildren</span><span class="p">(),</span> <span class="nf">(answer)-&gt;</span>
            <span class="nx">answer</span><span class="p">.</span><span class="nx">name</span><span class="p">()</span> <span class="o">==</span> <span class="nx">answerId</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">answerShape</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27">&#182;</a>
</div>
<p>console.log @answerLayer.getChildren()[0].name()</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="k">if</span> <span class="nx">answerShape</span><span class="p">.</span><span class="nx">className</span> <span class="o">is</span> <span class="s">&#39;Circle&#39;</span>
            <span class="nv">feedback = </span><span class="k">new</span> <span class="nx">Kinetic</span><span class="p">.</span><span class="nx">Circle</span>
              <span class="nv">x: </span><span class="nx">answerShape</span><span class="p">.</span><span class="nx">x</span><span class="p">()</span>
              <span class="nv">y: </span><span class="nx">answerShape</span><span class="p">.</span><span class="nx">y</span><span class="p">()</span>
              <span class="nv">radius: </span><span class="nx">answerShape</span><span class="p">.</span><span class="nx">radius</span><span class="p">()</span>
              <span class="nv">fillPatternImage: </span><span class="nx">image</span>
              <span class="nv">fillPatternRepeat: </span><span class="s">&#39;no-repeat&#39;</span>
              <span class="nv">fillPatternOffset:</span>
                <span class="nv">x: </span><span class="mi">20</span>
                <span class="nv">y: </span><span class="mi">20</span>
          <span class="k">else</span>
            <span class="nv">feedback = </span><span class="k">new</span> <span class="nx">Kinetic</span><span class="p">.</span><span class="nx">Rect</span>
              <span class="nv">x: </span><span class="nx">answerShape</span><span class="p">.</span><span class="nx">x</span><span class="p">()</span> <span class="o">-</span> <span class="nx">answerShape</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span>
              <span class="nv">y: </span><span class="nx">answerShape</span><span class="p">.</span><span class="nx">y</span><span class="p">()</span> <span class="o">-</span> <span class="nx">answerShape</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span>
              <span class="nv">width: </span><span class="nx">answerShape</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span>
              <span class="nv">height: </span><span class="nx">answerShape</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span>
              <span class="nv">fillPatternImage: </span><span class="nx">image</span>
              <span class="nv">fillPatternX: </span><span class="nx">answerShape</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">20</span>
              <span class="nv">fillPatternY: </span><span class="nx">answerShape</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">20</span>
              <span class="nv">fillPatternRepeat: </span><span class="s">&#39;no-repeat&#39;</span>

          <span class="nx">@feedbackLayer</span><span class="p">.</span><span class="nx">add</span> <span class="nx">feedback</span>
        <span class="nx">@feedbackLayer</span><span class="p">.</span><span class="nx">draw</span><span class="p">()</span>

      <span class="nv">_showCorrectAnswers: </span><span class="nf">(correctOptopns)-&gt;</span>
        <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">correctOptopns</span><span class="p">,</span> <span class="nf">(correctId)=&gt;</span>
          <span class="nv">correctAnswer = </span><span class="nx">_</span><span class="p">.</span><span class="nx">find</span> <span class="nx">@optionLayer</span><span class="p">.</span><span class="nx">getChildren</span><span class="p">(),</span> <span class="nf">(answer)-&gt;</span>
            <span class="nx">answer</span><span class="p">.</span><span class="nx">id</span><span class="p">()</span> <span class="o">==</span> <span class="nx">correctId</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28">&#182;</a>
</div>
<p>console.log correctAnswer
console.log @answerLayer.getChildren()[0].name()</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="k">if</span> <span class="nx">correctAnswer</span><span class="p">.</span><span class="nx">className</span> <span class="o">is</span> <span class="s">&#39;Circle&#39;</span>
            <span class="nv">feedbackCorrect = </span><span class="k">new</span> <span class="nx">Kinetic</span><span class="p">.</span><span class="nx">Circle</span>
              <span class="nv">x: </span><span class="nx">correctAnswer</span><span class="p">.</span><span class="nx">x</span><span class="p">()</span>
              <span class="nv">y: </span><span class="nx">correctAnswer</span><span class="p">.</span><span class="nx">y</span><span class="p">()</span>
              <span class="nv">radius: </span><span class="nx">correctAnswer</span><span class="p">.</span><span class="nx">radius</span><span class="p">()</span>
              <span class="nv">stroke: </span><span class="s">&#39;green&#39;</span>
              <span class="nv">strokeWidth: </span><span class="mi">6</span>
          <span class="k">else</span>
            <span class="nv">feedbackCorrect = </span><span class="k">new</span> <span class="nx">Kinetic</span><span class="p">.</span><span class="nx">Rect</span>
              <span class="nv">x: </span><span class="nx">correctAnswer</span><span class="p">.</span><span class="nx">x</span><span class="p">()</span>
              <span class="nv">y: </span><span class="nx">correctAnswer</span><span class="p">.</span><span class="nx">y</span><span class="p">()</span>
              <span class="nv">width: </span><span class="nx">correctAnswer</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span>
              <span class="nv">height: </span><span class="nx">correctAnswer</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span>
              <span class="nv">stroke: </span><span class="s">&#39;green&#39;</span>
              <span class="nv">strokeWidth: </span><span class="mi">6</span>

          <span class="nx">@feedbackLayer</span><span class="p">.</span><span class="nx">add</span> <span class="nx">feedbackCorrect</span>
        <span class="nx">@feedbackLayer</span><span class="p">.</span><span class="nx">draw</span><span class="p">()</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29">&#182;</a>
</div>
<p>add border to the hotspot canvas</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">_addBorderBox: </span><span class="nf">-&gt;</span>
        <span class="nv">borderBox = </span><span class="k">new</span> <span class="nx">Kinetic</span><span class="p">.</span><span class="nx">Rect</span>
          <span class="nv">name: </span><span class="s">&quot;border&quot;</span>
          <span class="nv">x: </span><span class="mi">0</span>
          <span class="nv">y: </span><span class="mi">0</span>
          <span class="nv">width: </span><span class="nx">@$el</span><span class="p">.</span><span class="nx">parent</span><span class="p">().</span><span class="nx">width</span><span class="p">()</span>
          <span class="nv">height: </span><span class="nx">@model</span><span class="p">.</span><span class="nx">get</span> <span class="s">&#39;height&#39;</span>
          <span class="nv">stroke: </span><span class="s">&#39;black&#39;</span>
          <span class="nv">strokeWidth: </span><span class="mi">1</span>
        <span class="nx">@imageLayer</span><span class="p">.</span><span class="nx">add</span> <span class="nx">borderBox</span>
        <span class="nx">@imageLayer</span><span class="p">.</span><span class="nx">draw</span><span class="p">()</span>

      <span class="nv">_drawExistingElements: </span><span class="nf">-&gt;</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">@textCollection</span>

        <span class="nx">@textCollection</span><span class="p">.</span><span class="nx">each</span> <span class="nf">(model, i)=&gt;</span>
          <span class="nx">@_addEachElements</span> <span class="s">&#39;Hotspot-Text&#39;</span><span class="p">,</span> <span class="nx">model</span>

        <span class="nx">@optionCollection</span><span class="p">.</span><span class="nx">each</span> <span class="nf">(model, i)=&gt;</span>
          <span class="k">if</span> <span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;shape&#39;</span><span class="p">)</span> <span class="o">is</span> <span class="s">&#39;Rect&#39;</span>
            <span class="nx">@_addEachElements</span> <span class="s">&#39;Hotspot-Rectangle&#39;</span><span class="p">,</span> <span class="nx">model</span>

          <span class="k">if</span> <span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;shape&#39;</span><span class="p">)</span> <span class="o">is</span> <span class="s">&#39;Circle&#39;</span>
            <span class="nx">@_addEachElements</span> <span class="s">&#39;Hotspot-Circle&#39;</span><span class="p">,</span> <span class="nx">model</span>

        <span class="nx">@imageCollection</span><span class="p">.</span><span class="nx">each</span> <span class="nf">(model, i)=&gt;</span>

          <span class="nx">@_addEachElements</span> <span class="s">&#39;Hotspot-Image&#39;</span><span class="p">,</span> <span class="nx">model</span>

      <span class="nv">_addEachElements: </span><span class="nf">(type, model)-&gt;</span>
        <span class="nx">@triggerMethod</span> <span class="s">&quot;add:hotspot:element&quot;</span><span class="p">,</span>
          <span class="nx">type</span>
        <span class="p">,</span>
          <span class="nv">left: </span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span> <span class="s">&#39;x&#39;</span>
          <span class="nv">top: </span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span> <span class="s">&#39;y&#39;</span>
        <span class="p">,</span>
          <span class="nx">model</span>

      <span class="nv">onAddHotspotElement: </span><span class="nf">(type, elementPos, model)-&gt;</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s">&quot;Hotspot-Circle&quot;</span><span class="p">)</span>
          <span class="nx">@_addCircle</span> <span class="nx">elementPos</span><span class="p">,</span> <span class="nx">model</span>

        <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s">&quot;Hotspot-Rectangle&quot;</span><span class="p">)</span>
          <span class="nx">@_addRectangle</span> <span class="nx">elementPos</span><span class="p">,</span> <span class="nx">model</span>

        <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s">&quot;Hotspot-Text&quot;</span><span class="p">)</span>
          <span class="nx">@_addTextElement</span> <span class="nx">elementPos</span><span class="p">,</span> <span class="nx">model</span>

        <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s">&quot;Hotspot-Image&quot;</span><span class="p">)</span>
          <span class="nx">@_addImageElement</span> <span class="nx">elementPos</span><span class="p">,</span> <span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;url&#39;</span><span class="p">),</span> <span class="nx">model</span>

      <span class="nv">_addCircle: </span><span class="nf">(elementPos, model)-&gt;</span>
        <span class="nv">hotspotElement = </span><span class="nx">model</span>

        <span class="nv">self = </span><span class="nx">@</span>

        <span class="nv">circle = </span><span class="k">new</span> <span class="nx">Kinetic</span><span class="p">.</span><span class="nx">Circle</span>
          <span class="nv">id: </span><span class="nx">hotspotElement</span><span class="p">.</span><span class="nx">get</span> <span class="s">&#39;id&#39;</span>
          <span class="nv">x: </span><span class="nx">hotspotElement</span><span class="p">.</span><span class="nx">get</span> <span class="s">&#39;x&#39;</span>
          <span class="nv">y: </span><span class="nx">hotspotElement</span><span class="p">.</span><span class="nx">get</span> <span class="s">&#39;y&#39;</span>
          <span class="nv">radius: </span><span class="nx">hotspotElement</span><span class="p">.</span><span class="nx">get</span> <span class="s">&#39;radius&#39;</span>
          <span class="nv">strokeWidth: </span><span class="mi">2</span>

        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">circle</span><span class="p">.</span><span class="nx">getId</span><span class="p">()</span>

        <span class="k">if</span> <span class="o">not</span> <span class="nx">@model</span><span class="p">.</span><span class="nx">get</span> <span class="s">&#39;transparent&#39;</span>
          <span class="nx">circle</span><span class="p">.</span><span class="nx">stroke</span> <span class="nx">hotspotElement</span><span class="p">.</span><span class="nx">get</span> <span class="s">&#39;color&#39;</span>

        <span class="nx">@optionLayer</span><span class="p">.</span><span class="nx">add</span> <span class="nx">circle</span>

        <span class="nx">@optionLayer</span><span class="p">.</span><span class="nx">draw</span><span class="p">()</span>


      <span class="nv">_addRectangle: </span><span class="nf">(elementPos, model)-&gt;</span>
        <span class="nv">hotspotElement = </span><span class="nx">model</span>

        <span class="nv">box = </span><span class="k">new</span> <span class="nx">Kinetic</span><span class="p">.</span><span class="nx">Rect</span>
          <span class="nv">id: </span><span class="nx">hotspotElement</span><span class="p">.</span><span class="nx">get</span> <span class="s">&#39;id&#39;</span>
          <span class="nv">x: </span><span class="nx">hotspotElement</span><span class="p">.</span><span class="nx">get</span> <span class="s">&#39;x&#39;</span>
          <span class="nv">y: </span><span class="nx">hotspotElement</span><span class="p">.</span><span class="nx">get</span> <span class="s">&#39;y&#39;</span>
          <span class="nv">width: </span><span class="nx">hotspotElement</span><span class="p">.</span><span class="nx">get</span> <span class="s">&#39;width&#39;</span>
          <span class="nv">height: </span><span class="nx">hotspotElement</span><span class="p">.</span><span class="nx">get</span> <span class="s">&#39;height&#39;</span>
          <span class="nv">strokeWidth: </span><span class="mi">2</span>
          <span class="nv">rotation: </span><span class="nx">hotspotElement</span><span class="p">.</span><span class="nx">get</span> <span class="s">&#39;angle&#39;</span>

        <span class="k">if</span> <span class="o">not</span> <span class="nx">@model</span><span class="p">.</span><span class="nx">get</span> <span class="s">&#39;transparent&#39;</span>
          <span class="nx">box</span><span class="p">.</span><span class="nx">stroke</span> <span class="nx">hotspotElement</span><span class="p">.</span><span class="nx">get</span> <span class="s">&#39;color&#39;</span>

        <span class="nx">@optionLayer</span><span class="p">.</span><span class="nx">add</span> <span class="nx">box</span>

        <span class="nx">@optionLayer</span><span class="p">.</span><span class="nx">draw</span><span class="p">()</span>

      <span class="nv">_addTextElement: </span><span class="nf">(elementPos, model)-&gt;</span>
        <span class="nv">hotspotElement = </span><span class="nx">model</span>

        <span class="nv">canvasText = </span><span class="k">new</span> <span class="nx">Kinetic</span><span class="p">.</span><span class="nx">Text</span>
          <span class="nv">x: </span><span class="nx">hotspotElement</span><span class="p">.</span><span class="nx">get</span> <span class="s">&#39;x&#39;</span>
          <span class="nv">y: </span><span class="nx">hotspotElement</span><span class="p">.</span><span class="nx">get</span> <span class="s">&#39;y&#39;</span>
          <span class="nv">text: </span><span class="nx">hotspotElement</span><span class="p">.</span><span class="nx">get</span> <span class="s">&#39;text&#39;</span>
          <span class="nv">opacity: </span><span class="mi">1</span>
          <span class="nv">fontFamily: </span><span class="nx">hotspotElement</span><span class="p">.</span><span class="nx">get</span> <span class="s">&#39;fontFamily&#39;</span>
          <span class="nv">fontSize: </span><span class="nx">hotspotElement</span><span class="p">.</span><span class="nx">get</span> <span class="s">&#39;fontSize&#39;</span>
          <span class="nv">fill: </span><span class="nx">hotspotElement</span><span class="p">.</span><span class="nx">get</span> <span class="s">&#39;fontColor&#39;</span>
          <span class="nv">fontStyle: </span><span class="nx">hotspotElement</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;fontBold&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="nx">hotspotElement</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;fontItalics&#39;</span><span class="p">)</span>
          <span class="nv">padding: </span><span class="mi">5</span>
          <span class="nv">rotation: </span><span class="nx">hotspotElement</span><span class="p">.</span><span class="nx">get</span> <span class="s">&#39;textAngle&#39;</span>

        <span class="nx">@textLayer</span><span class="p">.</span><span class="nx">add</span> <span class="nx">canvasText</span>

        <span class="nx">@textLayer</span><span class="p">.</span><span class="nx">draw</span><span class="p">()</span>

      <span class="nv">_addImageElement: </span><span class="nf">(elementPos, url, model)-&gt;</span>
        <span class="nv">hotspotElement = </span><span class="nx">model</span>
        <span class="nv">imageObject = </span><span class="k">new</span> <span class="nx">Image</span><span class="p">()</span>
        <span class="nv">imageObject.src = </span><span class="nx">hotspotElement</span><span class="p">.</span><span class="nx">get</span> <span class="s">&#39;url&#39;</span>
        <span class="nv">imageObject.onload = </span><span class="o">=&gt;</span>
          <span class="nv">imageElement = </span><span class="k">new</span> <span class="nx">Kinetic</span><span class="p">.</span><span class="nx">Image</span>
            <span class="nv">image: </span><span class="nx">imageObject</span>
            <span class="nv">x: </span><span class="nx">hotspotElement</span><span class="p">.</span><span class="nx">get</span> <span class="s">&#39;x&#39;</span>
            <span class="nv">y: </span><span class="nx">hotspotElement</span><span class="p">.</span><span class="nx">get</span> <span class="s">&#39;y&#39;</span>
            <span class="nv">width: </span><span class="nx">hotspotElement</span><span class="p">.</span><span class="nx">get</span> <span class="s">&#39;width&#39;</span>
            <span class="nv">height: </span><span class="nx">hotspotElement</span><span class="p">.</span><span class="nx">get</span> <span class="s">&#39;height&#39;</span>
            <span class="nv">rotation: </span><span class="nx">hotspotElement</span><span class="p">.</span><span class="nx">get</span> <span class="s">&#39;angle&#39;</span>
          <span class="nx">@imageLayer</span><span class="p">.</span><span class="nx">add</span> <span class="nx">imageElement</span>
          <span class="nx">@imageLayer</span><span class="p">.</span><span class="nx">draw</span><span class="p">()</span>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
